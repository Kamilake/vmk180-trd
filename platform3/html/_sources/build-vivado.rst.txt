Build the Vivado Design
=======================

Prerequisites
-------------

* Reference Design zip file

* Vivado Design Suite 2020.2

Build Flow Tutorial
-------------------

.. tip::

   You can skip this tutorial and move straight to the next tutorial if desired.
   A pre-built XSA file is provided at
   *$working_dir/vmk180_trd_platform3_2020.2/vivado/pre-built/vmk180_trd_platform3.xsa*

**Download Reference Design Files:**

Skip the following steps if the design zip file has already been downloaded and
extracted to a working directory

#. Download the VMK180 Targeted Reference Design ZIP file

#. Unzip Contents

The directory structure is described in the Introduction Section

**Generate Device Image and XSA:**

#. Enable Versal device support

   To enable Versal device support, you need to create two tcl initialization
   scripts, one for Vivado and one for HLS. Add the following line to each of
   the tcl scripts:

   .. code-block:: bash

      enable_beta_device *

   The initialization tcl script for Vivado shall be placed at:

   * **Linux**: $HOME/.Xilinx/Vivado/Vivado_init.tcl

   * **Windows**: %APPDATA%/Roaming/Xilinx/Vivado/Vivado_init.tcl

   Similarly, the initialization tcl script for HLS shall be placed at:

   * **Linux**: $HOME/.Xilinx/HLS_init.tcl

   * **Windows**: %APPDATA%/Roaming/Xilinx/HLS_init.tcl

#. Open the Vivado GUI.

   On Linux, at the command prompt enter:

   .. code-block:: bash

     cd $working_dir/vmk180_trd_platform3_2020.2/vivado
     vivado -source scripts/main.tcl

   A Vivado cockpit as shown below will open with vmk180_trd_platform3
   project populated.

   .. image:: images/vivado.PNG
     :width: 1200
     :alt: Vivado cockpit

#. In the Flow Navigator pane on the left-hand side under IP Integrator, click
   on *Open Block Design*. An IP Integrator (IPI) block design
   (*mrmac_subsys_wrapper.bd*) becomes visible that contains the
   Control, Interface and Processing System (CIPS) IP, NOC IP and MRMAC IP.

   .. image:: images/block_design.PNG
     :width: 1200
     :alt: IPI Block Design


#. In the Flow Navigator pane on the left-hand side under Program and Debug,
   click on *Generate Device Image*. The device image (pdi) for the design will
   be generated and available at
   *$working_dir/vmk180_trd_platform3_2020.2/vivado/vmk180_trd_platform3/vmk180_trd_platform3.runs/impl_1/mrmac_subsys_wrapper.pdi*.

#. After Device Image Generation completes successfully a window pops up. Click
   on *Cancel*

   .. image:: images/open_implemented_design.PNG
     :width: 300
     :alt: Open Implemented Design

#. To create the XSA, 

   * From the Vivado main menu, select File→ Export → Export Hardware. The Export Hardware dialog
     box opens.
   * Choose Include bitstream and click Next.
   * Provide a name for your exported file (or use the default provided) and choose the location. Click Next.
   * A warning message appears if a hardware module has already been exported. Click Yes to overwrite the
     existing XSA file, if the overwrite message is displayed.
   * Click Finish.



Resource Utlization 
-------------------

 A Summary and statics of Resource utlization for the platform is shown below.

   .. image:: images/utilization.PNG
     :width: 300
     :alt: Utlization Summary

   .. image:: images/utilization_stat.PNG
     :width: 300
     :alt: Utlization Summary
